{% extends "base.html" %}
{% from "macros/_form_helpers.html" import render_field %}

{% block content %}
<div class="container py-4">
    <div class="bg-light rounded-4 p-4 shadow-sm mb-4 d-flex flex-column flex-md-row justify-content-between">
        <div>
            <p class="text-uppercase text-muted small mb-1">Profile</p>
            <h2 class="h4 mb-1">Keep your FunList identity up to date</h2>
            <p class="text-muted mb-0">We use these details to personalize recommendations and highlight your capabilities across the platform.</p>
        </div>
        <div class="mt-3 mt-md-0 text-md-end">
            <a href="{{ url_for('profile') }}" class="btn btn-outline-secondary me-2">
                <i class="fas fa-eye me-1"></i>View Profile
            </a>
            <a href="{{ url_for('change_password') }}" class="btn btn-outline-primary">
                <i class="fas fa-key me-1"></i>Password
            </a>
        </div>
    </div>

    <form method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        <div class="row g-4">
            <div class="col-lg-8">
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Capabilities</h5>
                        <p class="text-muted mb-0">Enable the experiences you want to unlock inside FunList.</p>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-wrap gap-2 mb-4">
                            <button type="submit" name="activate_role" value="event_creator" class="btn btn-outline-success btn-sm">
                                <i class="fas fa-calendar-plus me-1"></i>Become an Event Creator
                            </button>
                            <button type="submit" name="activate_role" value="organizer" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-building me-1"></i>Organizer Access
                            </button>
                            <button type="submit" name="activate_role" value="vendor" class="btn btn-outline-warning btn-sm">
                                <i class="fas fa-store me-1"></i>Vendor Tools
                            </button>
                            <button type="submit" name="activate_role" value="sponsor" class="btn btn-outline-danger btn-sm">
                                <i class="fas fa-handshake me-1"></i>Sponsor Mode
                            </button>
                        </div>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-check card h-100 border rounded-4 p-3">
                                    {{ form.enable_event_creator(class="form-check-input", id="enable_event_creator") }}
                                    <label class="form-check-label fw-semibold" for="enable_event_creator">Event Creator</label>
                                    <p class="text-muted small mb-0">List, manage, and highlight your events.</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check card h-100 border rounded-4 p-3">
                                    {{ form.enable_organizer(class="form-check-input", id="enable_organizer") }}
                                    <label class="form-check-label fw-semibold" for="enable_organizer">Organizer</label>
                                    <p class="text-muted small mb-0">Tell your venue or org story, add venues, and promote experiences.</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check card h-100 border rounded-4 p-3">
                                    {{ form.enable_vendor(class="form-check-input", id="enable_vendor") }}
                                    <label class="form-check-label fw-semibold" for="enable_vendor">Vendor</label>
                                    <p class="text-muted small mb-0">Promote services such as catering, AV, or entertainment.</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check card h-100 border rounded-4 p-3">
                                    {{ form.enable_sponsor(class="form-check-input", id="enable_sponsor") }}
                                    <label class="form-check-label fw-semibold" for="enable_sponsor">Sponsor</label>
                                    <p class="text-muted small mb-0">Share your ideal sponsorship opportunities.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Personal Information</h5>
                        <p class="text-muted mb-0">Your name, title, and how FunList can reach you.</p>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ render_field(form.username, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.title, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.first_name, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.last_name, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.phone, class="form-control") }}
                            </div>
                            <div class="col-12">
                                <div class="form-check form-switch mb-2">
                                    {{ form.newsletter_opt_in(class="form-check-input", id="newsletter_opt_in") }}
                                    <label class="form-check-label" for="newsletter_opt_in">Send me the FunList newsletter</label>
                                </div>
                                <div class="form-check form-switch">
                                    {{ form.marketing_opt_in(class="form-check-input", id="marketing_opt_in") }}
                                    <label class="form-check-label" for="marketing_opt_in">Share curated partner opportunities with me</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Preferences</h5>
                        <p class="text-muted mb-0">Help us personalize your event feed.</p>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ render_field(form.event_focus, class="form-select", multiple=True) }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.preferred_locations, class="form-control") }}
                            </div>
                            <div class="col-12">
                                {{ render_field(form.event_interests, class="form-control") }}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Social Links</h5>
                        <p class="text-muted mb-0">Drive traffic to your favorite channels.</p>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ render_field(form.facebook_url, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.instagram_url, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.twitter_url, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.linkedin_url, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.tiktok_url, class="form-control") }}
                            </div>
                        </div>
                    </div>
                </div>

                {% if current_user.is_organizer %}
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Organizer Information</h5>
                        <p class="text-muted mb-0">Tell venues and sponsors about your organization.</p>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ render_field(form.company_name, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.organizer_website, class="form-control") }}
                            </div>
                            <div class="col-12">
                                {{ render_field(form.organizer_description, class="form-control", rows="4") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.business_street, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.business_city, class="form-control") }}
                            </div>
                            <div class="col-md-4">
                                {{ render_field(form.business_state, class="form-control") }}
                            </div>
                            <div class="col-md-4">
                                {{ render_field(form.business_zip, class="form-control") }}
                            </div>
                            <div class="col-md-4">
                                {{ render_field(form.business_phone, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.business_email, class="form-control") }}
                            </div>
                            <div class="col-12">
                                {{ render_field(form.advertising_opportunities, class="form-control", rows="3") }}
                            </div>
                            <div class="col-12">
                                {{ render_field(form.sponsorship_opportunities, class="form-control", rows="3") }}
                            </div>
                        </div>
                        <div class="alert alert-info mt-3">
                            <i class="fas fa-map-marker-alt me-2"></i>Manage venues from the <a href="{{ url_for('my_venues') }}">Venues dashboard</a>.
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if current_user.is_vendor %}
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Vendor Profile</h5>
                        <p class="text-muted mb-0">Spotlight the services you offer.</p>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ render_field(form.vendor_type, class="form-select") }}
                            </div>
                            <div class="col-12">
                                {{ render_field(form.vendor_description, class="form-control", rows="4") }}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if current_user.is_sponsor and not current_user.is_organizer %}
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Sponsor Preferences</h5>
                        <p class="text-muted mb-0">Describe the types of partnerships you want.</p>
                    </div>
                    <div class="card-body">
                        {{ render_field(form.sponsorship_opportunities, class="form-control", rows="4") }}
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="col-lg-4">
                <div class="card shadow-sm border-0 sticky-top" style="top: 90px;">
                    <div class="card-body">
                        <h5 class="mb-3">Save Changes</h5>
                        <p class="text-muted small">Always click save so FunList can reflect your latest information.</p>
                        <div class="d-grid gap-2">
                            {{ form.submit(class="btn btn-primary btn-lg") }}
                            <a href="{{ url_for('profile') }}" class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}
