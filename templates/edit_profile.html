{% extends "base.html" %}
{% from "macros/_form_helpers.html" import render_field %}

{% block content %}
<div class="container py-4">
    <div class="bg-light rounded-4 p-4 shadow-sm mb-4 d-flex flex-column flex-md-row justify-content-between">
        <div>
            <p class="text-uppercase text-muted small mb-1">Profile</p>
            <h2 class="h4 mb-1">Keep your FunList identity up to date</h2>
            <p class="text-muted mb-0">We use these details to personalize recommendations and highlight your capabilities across the platform.</p>
        </div>
        <div class="mt-3 mt-md-0 text-md-end">
            <a href="{{ url_for('profile') }}" class="btn btn-outline-secondary me-2">
                <i class="fas fa-eye me-1"></i>View Profile
            </a>
            <a href="{{ url_for('change_password') }}" class="btn btn-outline-primary">
                <i class="fas fa-key me-1"></i>Password
            </a>
        </div>
    </div>

    <form method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        <div class="row g-4">
            <div class="col-lg-8">
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Capabilities</h5>
                        <p class="text-muted mb-0">Enable the experiences you want to unlock inside FunList.</p>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-light border rounded-4 mb-3 d-flex align-items-start gap-2">
                            <i class="fas fa-toggle-on text-primary mt-1"></i>
                            <div>
                                <div class="fw-semibold">Pick your capabilities with the switches below.</div>
                                <div class="text-muted small">Organizer automatically includes Event Creator. Turn on what you need, complete the matching fields that appear, then click Save.</div>
                            </div>
                        </div>
                        <div class="row g-3">
                            <div class="col-md-6">
                                {% set event_creator_on = form.enable_event_creator.data %}
                                <div class="border rounded-4 h-100 p-3">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="d-flex gap-2">
                                            <i class="fas fa-calendar-plus text-success mt-1"></i>
                                            <div>
                                                <label class="fw-semibold d-block" for="enable_event_creator">Event Creator</label>
                                                <p class="text-muted small mb-2">List, manage, and highlight your events.</p>
                                                <span class="badge rounded-pill {{ 'bg-success text-white' if event_creator_on else 'bg-light text-muted' }}">
                                                    {{ 'On' if event_creator_on else 'Off' }}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-check form-switch mb-0">
                                            {{ form.enable_event_creator(class="form-check-input", id="enable_event_creator") }}
                                            <label class="form-check-label visually-hidden" for="enable_event_creator">Enable event creator</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                {% set organizer_on = form.enable_organizer.data %}
                                <div class="border rounded-4 h-100 p-3">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="d-flex gap-2">
                                            <i class="fas fa-building text-primary mt-1"></i>
                                            <div>
                                                <label class="fw-semibold d-block" for="enable_organizer">Organizer</label>
                                                <p class="text-muted small mb-2">Tell your venue or org story, add venues, and promote experiences.</p>
                                                <span class="badge rounded-pill {{ 'bg-success text-white' if organizer_on else 'bg-light text-muted' }}">
                                                    {{ 'On' if organizer_on else 'Off' }}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-check form-switch mb-0">
                                            {{ form.enable_organizer(class="form-check-input", id="enable_organizer") }}
                                            <label class="form-check-label visually-hidden" for="enable_organizer">Enable organizer</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                {% set vendor_on = form.enable_vendor.data %}
                                <div class="border rounded-4 h-100 p-3">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="d-flex gap-2">
                                            <i class="fas fa-store text-warning mt-1"></i>
                                            <div>
                                                <label class="fw-semibold d-block" for="enable_vendor">Vendor</label>
                                                <p class="text-muted small mb-2">Promote services such as catering, AV, or entertainment.</p>
                                                <span class="badge rounded-pill {{ 'bg-success text-white' if vendor_on else 'bg-light text-muted' }}">
                                                    {{ 'On' if vendor_on else 'Off' }}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-check form-switch mb-0">
                                            {{ form.enable_vendor(class="form-check-input", id="enable_vendor") }}
                                            <label class="form-check-label visually-hidden" for="enable_vendor">Enable vendor</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                {% set sponsor_on = form.enable_sponsor.data %}
                                <div class="border rounded-4 h-100 p-3">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="d-flex gap-2">
                                            <i class="fas fa-handshake text-danger mt-1"></i>
                                            <div>
                                                <label class="fw-semibold d-block" for="enable_sponsor">Sponsor</label>
                                                <p class="text-muted small mb-2">Share your ideal sponsorship opportunities.</p>
                                                <span class="badge rounded-pill {{ 'bg-success text-white' if sponsor_on else 'bg-light text-muted' }}">
                                                    {{ 'On' if sponsor_on else 'Off' }}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-check form-switch mb-0">
                                            {{ form.enable_sponsor(class="form-check-input", id="enable_sponsor") }}
                                            <label class="form-check-label visually-hidden" for="enable_sponsor">Enable sponsor</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p class="text-muted small mt-3 mb-0">
                            <i class="fas fa-info-circle me-1"></i>Organizer automatically turns on Event Creator. Vendor and sponsor details show up below only when their switches are on.
                        </p>
                    </div>
                </div>

                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Personal Information</h5>
                        <p class="text-muted mb-0">Your name, title, and how FunList can reach you.</p>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ render_field(form.username, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.title, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.first_name, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.last_name, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.phone, class="form-control") }}
                            </div>
                            <div class="col-12">
                                <div class="form-check form-switch mb-2">
                                    {{ form.newsletter_opt_in(class="form-check-input", id="newsletter_opt_in") }}
                                    <label class="form-check-label" for="newsletter_opt_in">Send me the FunList newsletter</label>
                                </div>
                                <div class="form-check form-switch">
                                    {{ form.marketing_opt_in(class="form-check-input", id="marketing_opt_in") }}
                                    <label class="form-check-label" for="marketing_opt_in">Share curated partner opportunities with me</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Preferences</h5>
                        <p class="text-muted mb-0">Help us personalize your event feed.</p>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ render_field(form.event_focus, class="form-select", multiple=True) }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.preferred_locations, class="form-control") }}
                            </div>
                            <div class="col-12">
                                {{ render_field(form.event_interests, class="form-control") }}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Social Links</h5>
                        <p class="text-muted mb-0">Drive traffic to your favorite channels.</p>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ render_field(form.facebook_url, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.instagram_url, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.twitter_url, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.linkedin_url, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.tiktok_url, class="form-control") }}
                            </div>
                        </div>
                    </div>
                </div>

                {% if current_user.is_organizer %}
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Organizer Information</h5>
                        <p class="text-muted mb-0">Tell venues and sponsors about your organization.</p>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ render_field(form.company_name, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.organizer_website, class="form-control") }}
                            </div>
                            <div class="col-12">
                                {{ render_field(form.organizer_description, class="form-control", rows="4") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.business_street, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.business_city, class="form-control") }}
                            </div>
                            <div class="col-md-4">
                                {{ render_field(form.business_state, class="form-control") }}
                            </div>
                            <div class="col-md-4">
                                {{ render_field(form.business_zip, class="form-control") }}
                            </div>
                            <div class="col-md-4">
                                {{ render_field(form.business_phone, class="form-control") }}
                            </div>
                            <div class="col-md-6">
                                {{ render_field(form.business_email, class="form-control") }}
                            </div>
                            <div class="col-12">
                                {{ render_field(form.advertising_opportunities, class="form-control", rows="3") }}
                            </div>
                            <div class="col-12">
                                {{ render_field(form.sponsorship_opportunities, class="form-control", rows="3") }}
                            </div>
                        </div>
                        <div class="alert alert-info mt-3">
                            <i class="fas fa-map-marker-alt me-2"></i>Manage venues from the <a href="{{ url_for('my_venues') }}">Venues dashboard</a>.
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if current_user.is_vendor %}
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Vendor Profile</h5>
                        <p class="text-muted mb-0">Spotlight the services you offer.</p>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ render_field(form.vendor_type, class="form-select") }}
                            </div>
                            <div class="col-12">
                                {{ render_field(form.vendor_description, class="form-control", rows="4") }}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if current_user.is_sponsor and not current_user.is_organizer %}
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-1">Sponsor Preferences</h5>
                        <p class="text-muted mb-0">Describe the types of partnerships you want.</p>
                    </div>
                    <div class="card-body">
                        {{ render_field(form.sponsorship_opportunities, class="form-control", rows="4") }}
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="col-lg-4">
                <div class="card shadow-sm border-0 sticky-top" style="top: 90px;">
                    <div class="card-body">
                        <h5 class="mb-3">Save Changes</h5>
                        <p class="text-muted small">Always click save so FunList can reflect your latest information.</p>
                        <div class="d-grid gap-2">
                            {{ form.submit(class="btn btn-primary btn-lg") }}
                            <a href="{{ url_for('profile') }}" class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}
