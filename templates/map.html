{% extends "base.html" %}

{% block title %}Map - FunList.ai{% endblock %}

{% block head %}
<!-- Google Maps API -->
<script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&libraries=places" defer></script>
<style>
    #map {
        height: 600px;
        width: 100%;
        margin-top: 15px;
        border-radius: 8px;
    }

    .filter-bar {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .map-container {
        position: relative;
    }

    .user-location-button {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 1000;
        background-color: white;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-3">
  <h1 class="text-center mb-3">Map Events</h1>

  <!-- Horizontal Filter Bar at the top -->
  <div class="filter-bar mb-3">
    <div class="row g-2 justify-content-center">
        <div class="col-md-3">
            <input type="text" class="form-control" id="locationSearch" placeholder="Search location...">
        </div>
        <div class="col-md-2">
            <select class="form-select" id="categoryFilter">
                <option selected>All Categories</option>
                <option>Sports</option>
                <option>Music</option>
                <option>Arts</option>
                <option>Food</option>
                <option>Other</option>
            </select>
        </div>
        <div class="col-md-2">
            <select class="form-select" id="dateFilter">
                <option selected>Any Date</option>
                <option>Today</option>
                <option>Tomorrow</option>
                <option>This Weekend</option>
                <option>Next Week</option>
            </select>
        </div>
        <div class="col-md-2">
            <select class="form-select" id="funFilter">
                <option selected>All Fun Ratings</option>
                <option value="5">⭐⭐⭐⭐⭐ (5)</option>
                <option value="4">⭐⭐⭐⭐ (4+)</option>
                <option value="3">⭐⭐⭐ (3+)</option>
            </select>
        </div>
        <div class="col-md-2">
            <button id="applyFilters" class="btn btn-primary w-100">Apply Filters</button>
        </div>
    </div>
  </div>

  <!-- Single row with map taking full width -->
  <div class="row">
    <div class="col-12">
      <div id="map" class="map-container shadow"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Load map.js script which uses Google Maps -->
<script src="{{ url_for('static', filename='js/map.js') }}"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize map after the page loads
    if (typeof google !== 'undefined' && typeof MapModule !== 'undefined') {
      MapModule.init('map');

      // Setup location search
      if (MapModule.initializeLocationSearch) {
        MapModule.initializeLocationSearch('locationSearch');
      }

      // Setup filter buttons
      document.getElementById('applyFilters').addEventListener('click', function() {
        const category = document.getElementById('categoryFilter').value;
        const date = document.getElementById('dateFilter').value;
        const funRating = document.getElementById('funFilter').value;

        if (MapModule.applyFilters) {
          MapModule.applyFilters(category, date, funRating);
        }
      });
    }
  });
</script>
{% endblock %}