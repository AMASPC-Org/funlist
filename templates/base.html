<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="FunList.ai - Your AI-powered guide to fun events and activities in your area">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://unpkg.com https://auth.util.repl.co; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; img-src 'self' data: https:; font-src 'self' https://cdnjs.cloudflare.com; connect-src 'self' https:; frame-src 'self' https://auth.util.repl.co https://*.replit.dev;">

    <title>{% block title %}FunList.ai{% endblock %}</title>
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Select2 for enhanced dropdowns -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/@ttskch/select2-bootstrap4-theme@x.x.x/dist/select2-bootstrap4.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}?v={{ range(1, 10000) | random }}">
    <!-- Load Leaflet JS after the page has loaded -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
</head>
<body {% if new_registration %}data-new-registration="true"{% endif %}>
  {% include 'partials/navbar.html' %}

<main role="main" class="mt-2">
    <!-- Flash messages - positioned below navbar -->
    <div class="flash-messages-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    {% block content %}{% endblock %}
</main>

  {% if new_registration %}
    {% include 'partials/post_registration_wizard.html' %}
  {% endif %}

  <!-- Footer -->
<footer class="bg-dark text-white pt-5 pb-4">
        <div class="container text-md-left">
            <div class="row text-md-left">
                <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mt-3">
                    <h5 class="text-uppercase mb-4 font-weight-bold text-primary">Company</h5>
                    <p><a href="/about" class="text-white">About Us</a></p>
                    <p><a href="/submit-event" class="text-white">Submit an Event</a></p>
                    <p><a href="/advertising" class="text-white">Advertising</a></p>
                    <p><a href="https://localmarketingtool.ai" class="text-white" target="_blank" rel="noopener">LocalMarketingTool.ai</a></p>
                </div>
                <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mt-3">
                    <h5 class="text-uppercase mb-4 font-weight-bold text-primary">Connect</h5>
                    <p><a href="#" id="feedbackButton" class="text-white">Feedback</a></p>
                    <p><a href="#" id="subscribeButton" class="text-white">Subscribe to Newsletter</a></p>
                    <p><a href="/contact" class="text-white">Contact Us</a></p>
                    <p>
                        <a href="https://www.facebook.com/funlist.ai" class="text-white me-2" target="_blank" rel="noopener"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://www.instagram.com/funlist.ai" class="text-white me-2" target="_blank" rel="noopener"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.linkedin.com/company/funlist-ai" class="text-white" target="_blank" rel="noopener"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://twitter.com/funlist_ai" class="text-white ms-2" target="_blank" rel="noopener"><i class="fab fa-twitter"></i></a>
                    </p>
                </div>
                <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mt-3">
                    <h5 class="text-uppercase mb-4 font-weight-bold text-primary">Account</h5>
                    <p><a href="/login" class="text-white">Log In</a></p>
                    <p><a href="/signup" class="text-white">Sign Up</a></p>
                    <p><a href="/profile" class="text-white">My Profile</a></p>
                    <p><a href="/become-organizer" class="text-white">For Organizers</a></p>
                    <p><a href="/become-venue" class="text-white">For Venues</a></p>
                    <p><a href="/become-vendor" class="text-white">For Vendors</a></p>
                </div>
                <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mt-3">
                    <h5 class="text-uppercase mb-4 font-weight-bold text-primary">Resources</h5>
                    <p><a href="/help" class="text-white">Help Center</a></p>
                    <p><a href="/faq" class="text-white">FAQ</a></p>
                    <p><a href="/events" class="text-white">Browse Events</a></p>
                    <p><a href="/map" class="text-white">Event Map</a></p>
                    <p><a href="/venues" class="text-white">Venues</a></p>
                    <p><a href="/vendors" class="text-white">Vendors</a></p>
                    
                </div>
            </div>
            <hr class="my-3">
            <div class="row align-items-center">
                <div class="col-md-7 col-lg-8">
                    <p>Â© <script>document.write(new Date().getFullYear())</script> FunList.ai. All rights reserved | Brought to you by <a href="https://americanmarketingalliance.com" class="text-primary" target="_blank" rel="noopener">American Marketing Alliance SPC</a></p>
                </div>
                <div class="col-md-5 col-lg-4 text-md-end">
                    <a href="https://americanmarketingalliance.com" class="text-primary me-3" target="_blank" rel="noopener">AMA</a>
                    <a href="https://localmarketingtool.ai" class="text-primary" target="_blank" rel="noopener">LocalMarketingTool.ai</a>
                </div>
            </div>
        </div>
    </footer>
{% include 'partials/floating_buttons.html' %}

<!-- jQuery (required for Select2) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script>
  // Global bootstrap variable
  var bootstrap = window.bootstrap;
</script>

<!-- Select2 for enhanced dropdowns -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js" crossorigin="anonymous"></script>

<!-- Initialize Bootstrap components -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize all tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>

<!-- Event Emitter Helper -->
<script src="{{ url_for('static', filename='js/emitter.js') }}"></script>

<!-- Custom JavaScript -->
<script src="{{ url_for('static', filename='js/main.js') }}" defer></script>

    <script>
      // Enhanced global error handler for all scripts
      window.onerror = function(message, source, lineno, colno, error) {
        console.error("Global error handler caught:", message);

        // Check if it's a cross-origin script error
        if (message === "Script error." || message === "Script error") {
          console.log("Cross-origin script error detected. Check for cross-origin issues.");
          // Add crossorigin attribute to scripts dynamically
          document.querySelectorAll('script[src^="https://"]').forEach(function(script) {
            if (!script.hasAttribute('crossorigin')) {
              script.setAttribute('crossorigin', 'anonymous');
            }
          });
        } else if (error) {
          console.error("Error details:", error);
        }

        return true; // Prevents the default browser error handling
      };

      // Unhandled promise rejection handler
      window.addEventListener('unhandledrejection', function(event) {
        console.error('Unhandled promise rejection:', event.reason);
      });

      // Safe function execution wrapper
      window.safeExecute = function(fn, fallback) {
        try {
          if (typeof fn === 'function') {
            return fn();
          }
        } catch (e) {
          console.error('Error executing function:', e);
          if (typeof fallback === 'function') {
            return fallback();
          }
        }
        return null;
      };
    </script>

    {% block scripts %}{% endblock %}
{% if current_user.is_authenticated and current_user.email == 'ryan@funlist.ai' %}
<script src="{{ url_for('static', filename='js/admin_events.js') }}"></script>
{% endif %}

{% if new_registration %}
<script src="{{ url_for('static', filename='js/post_registration_wizard.js') }}"></script>
{% endif %}

{% block extra_js %}{% endblock %}
{% include 'partials/cookie_consent.html' %}
</body>
</html>